# Модель интеллектуального анализатора одномерного временного ряда на примере кардиосигнала

## О проекте

Выпускная квалификационная работа (ВКР).

Проект реализует **гибридную модель** анализа кардиосигнала,
объединяющую физическое моделирование сердечно-сосудистой системы
(система обыкновенных дифференциальных уравнений) с методами
машинного обучения (Reservoir Computing, Neural ODE).

В качестве референсных данных используются реальные записи ЭКГ
из открытой базы
[PhysioNet ECG-ID Database](https://physionet.org/content/ecgiddb/1.0.0/).

## Архитектура модели

Реальное ЭКГ (PhysioNet)          Гибридная ODE-модель
         │                                  │
         ▼                                  ▼
┌─────────────────┐              ┌─────────────────────┐
│  Загрузка EDF   │              │  10 переменных       │
│  Фильтрация     │              │  состояния:          │
│  R-пики         │              │  Qmt, Qav, Qtc, Qpv │
│  Сегментация    │              │  Vlv, Vao, Vvc       │
│  Усреднение     │              │  Vrv, Vpa, Vpu       │
└────────┬────────┘              └──────────┬──────────┘
         │                                  │
         ▼                                  ▼
┌─────────────────┐              ┌─────────────────────┐
│  Референсный    │              │  ReservoirNet (RC)   │
│  кардиоцикл     │              │  → Pperi, Vspt       │
└────────┬────────┘              └──────────┬──────────┘
         │                                  │
         └──────────┬───────────────────────┘
                    ▼
          ┌─────────────────┐
          │   СРАВНЕНИЕ     │
          │   Корреляция    │
          │   RMSE          │
          │   Визуализация  │
          └─────────────────┘

## Компоненты системы

### 1. Загрузчик ЭКГ (`PhysioNetECGLoader`)
- Автоматическая загрузка записей с PhysioNet
- Чтение файлов формата EDF (European Data Format)
- Поддержка 90 пациентов, до 20 записей на каждого

### 2. Предобработка (`ECGPreprocessor`)
- Полосовой фильтр Баттерворта (0.5–40 Гц)
- Нормализация амплитуды
- Детекция R-пиков
- Сегментация на отдельные кардиоциклы
- Построение усреднённого референсного цикла

### 3. Нейросеть Reservoir Computing (`ReservoirNet`)
- Фиксированные случайные веса входного слоя и резервуара
- Обучаемый слой считывания (readout)
- Вход: 5 объёмов камер сердца
- Выход: перикардиальное давление (Pperi), объём перегородки (Vspt)

### 4. Гибридная ODE-модель (`HybridODEFunc`)
- 10 обыкновенных дифференциальных уравнений
- Описание гемодинамики: потоки через клапаны, объёмы камер
- 37 физиологических параметров
- Решение методом Богацки—Шампина (Bosh3)

### 5. Модуль сравнения (`ModelECGComparator`)
- Извлечение суррогатного ЭКГ из модели (dPlv/dt)
- Корреляция Пирсона между модельным и реальным сигналом
- Среднеквадратичная ошибка (RMSE)

## Используемые технологии

| Технология | Назначение |
|------------|------------|
| Python 3.11 | Язык программирования |
| PyTorch | Нейросетевые вычисления |
| torchdiffeq | Решение Neural ODE |
| NumPy | Работа с массивами |
| SciPy | Цифровая фильтрация, поиск пиков |
| Matplotlib | Построение графиков |
| pyedflib | Чтение EDF-файлов |
| MNE | Обработка биомедицинских сигналов |
| wfdb | Загрузка данных с PhysioNet |

## Установка

### Системные требования
- Python 3.10 или 3.11
- Windows 10/11, Linux или macOS
- 4 ГБ оперативной памяти
- Интернет-соединение (для загрузки ЭКГ)

### Порядок установки

1. Клонируйте репозиторий:
bash
git clone https://github.com/NasMaksi/hybrid-ODE-reservoir-PhysioNet.git
cd hybrid-ODE-reservoir-PhysioNet
   2. Создайте виртуальное окружение:
bash 
python 
-m venv 
.venv
3. Активируйте окружение:
bash
Windows
.venv\Scripts\activate
Linux / macOS
source .venv/bin/activate
4. Установите зависимости:
bash
pip install -r requirements.txt

## Запуск
bash
python main.py

### Программа запросит:
1. **Номер пациента** (1–90) — из базы ECG-ID
2. **Номер записи** (1–20) — конкретная ЭКГ-запись
3. **Начальные условия** — 10 значений состояния модели
   (или Enter для значений по умолчанию)
4. **Длительность моделирования** — в секундах
   (или Enter — подбирается автоматически по ЧСС)

## Результаты

Программа генерирует 6 графиков:

| График | Описание |
|--------|----------|
| 1 | Реальное ЭКГ с отмеченными R-пиками |
| 2 | Все кардиоциклы + средний референсный цикл |
| 3 | Объёмы камер сердца (из ODE-модели) |
| 4 | Потоки через клапаны (из ODE-модели) |
| 5 | Суррогатный ЭКГ-сигнал из модели |
| 6 | Сравнение модельного и реального сигнала |

## Источники данных

- **ECG-ID Database** — Lugovaya T.S., 2005
  https://physionet.org/content/ecgiddb/1.0.0/
- 310 записей от 90 человек
- Частота дискретизации: 500 Гц
- Формат: EDF (European Data Format)

## Структура проекта
hybrid-ODE-reservoir-PhysioNet/
├── .gitignore           — исключения для Git
├── README.md            — описание проекта (этот файл)
├── requirements.txt     — список зависимостей
└── main.py              — основной код программы
    ├── PhysioNetECGLoader    — загрузка ЭКГ
    ├── ECGPreprocessor       — обработка сигнала
    ├── ReservoirNet          — нейросеть (RC)
    ├── HybridODEFunc         — система ОДУ
    ├── ModelECGComparator    — сравнение
    └── main()                — главная функция

## Автор

**Максимова Анастасия Александровна** — студент 4 курса, направление «Прикладная математика и информатика»

Российский университет дружбы народов (РУДН)

Научный руководитель: **Андриков Денис Анатольевич**

2025 г.

## Лицензия

Проект создан в рамках выпускной квалификационной работы.
Данные ЭКГ предоставлены PhysioNet под лицензией
[Open Data Commons Attribution License v1.0](https://physionet.org/content/ecgiddb/1.0.0/).